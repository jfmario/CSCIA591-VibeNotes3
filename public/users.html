<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>VibeNotes - All Users</title>
  <link rel="stylesheet" href="/styles.css">
</head>
<body>
  <div class="container container-wide">
    <h1>All Users</h1>
    
    <div class="nav-links">
      <a href="/">Home</a>
      <a href="/notes">My Notes</a>
      <a href="/notes/create">Create Note</a>
      <a href="/profile">My Profile</a>
      <a href="/api/auth/logout" onclick="event.preventDefault(); logout();">Logout</a>
    </div>
    
    <div id="errorMessage" class="error-message" style="display: none;"></div>
    <div id="loadingMessage" style="text-align: center; color: #666; margin: 20px 0;">Loading users...</div>
    
    <div id="usersContainer" class="users-grid" style="display: none;"></div>
  </div>

  <script>
    async function loadUsers() {
      try {
        // Check if authenticated
        const authResponse = await fetch('/api/auth/me');
        const authData = await authResponse.json();
        
        if (!authData.authenticated) {
          window.location.href = '/login';
          return;
        }

        // Load all users
        const response = await fetch('/api/profile/users');
        const data = await response.json();
        
        if (response.ok) {
          const usersContainer = document.getElementById('usersContainer');
          const loadingMessage = document.getElementById('loadingMessage');
          
          if (data.users.length === 0) {
            loadingMessage.textContent = 'No users found.';
            return;
          }
          
          usersContainer.innerHTML = '';
          
          data.users.forEach(user => {
            const userCard = document.createElement('div');
            userCard.className = 'user-card';
            
            let avatarHtml = '';
            if (user.avatar_path) {
              avatarHtml = `<img src="${user.avatar_path}" alt="${user.username}" class="user-card-avatar">`;
            } else {
              avatarHtml = `<div class="user-card-avatar-placeholder">ðŸ‘¤</div>`;
            }
            
            userCard.innerHTML = `
              ${avatarHtml}
              <div class="user-card-username">${escapeHtml(user.username)}</div>
              <div class="user-card-description">${user.description ? escapeHtml(user.description) : '<em style="color: #999;">No description</em>'}</div>
              <a href="/profile?userId=${user.id}" style="text-decoration: none; margin-top: 10px; display: inline-block;">
                <button style="padding: 6px 12px; font-size: 14px; background: #667eea; color: white; border: none; border-radius: 6px; cursor: pointer; width: 100%;">View Profile</button>
              </a>
            `;
            
            usersContainer.appendChild(userCard);
          });
          
          loadingMessage.style.display = 'none';
          usersContainer.style.display = 'grid';
        } else {
          showError(data.error || 'Failed to load users');
        }
      } catch (error) {
        console.error('Error loading users:', error);
        showError('An error occurred while loading users');
      }
    }

    async function logout() {
      try {
        const response = await fetch('/api/auth/logout', {
          method: 'POST'
        });
        
        if (response.ok) {
          window.location.href = '/';
        }
      } catch (error) {
        console.error('Error logging out:', error);
      }
    }

    function showError(message) {
      const errorDiv = document.getElementById('errorMessage');
      errorDiv.textContent = message;
      errorDiv.style.display = 'block';
      document.getElementById('loadingMessage').style.display = 'none';
    }

    function escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }

    loadUsers();
  </script>
</body>
</html>

